var S={init:function(){S.Drawing.init(".canvas"),document.body.classList.add(".personalities"),S.UI.simulate("I'm|冰梦|welcome to|visit my blog|#countdown 3"),S.Drawing.loop((function(){S.Shape.render()}))}};S.Drawing=function(){var t,e,i,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};return{init:function(i){t=document.querySelector(i),e=t.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",(function(t){S.Drawing.adjustCanvas()}))},loop:function(t){i=i||t,this.clearFrame(),i(),n.call(window,this.loop.bind(this))},adjustCanvas:function(){t.width=window.innerWidth-100,t.height=window.innerHeight-30},clearFrame:function(){e.clearRect(0,0,t.width,t.height)},getArea:function(){return{w:t.width,h:t.height}},drawCircle:function(t,i){e.fillStyle=i.render(),e.beginPath(),e.arc(t.x,t.y,t.z,0,2*Math.PI,!0),e.closePath(),e.fill()}}}(),S.UI=function(){var t,e,i,n=30,a=[],h="#";function r(t){var e;return t.getHours()+":"+(e=(e=t.getMinutes())<10?"0"+e:e)}function o(i,n,a,h){clearInterval(t),i(e=h?a:1),(!a||!h&&e<a||h&&e>0)&&(t=setInterval((function(){i(e=h?e-1:e+1),(!h&&a&&e===a||h&&0===e)&&clearInterval(t)}),n))}function s(t){var e,c;o((function(d){switch(c=a.shift(),e=function(t){return(t=t&&t.split(" ")[0])&&t[0]===h&&t.substring(1)}(c),t=function(t){return t&&t.split(" ")[1]}(c),e){case"countdown":o((function(t){0===t?0===a.length?(S.Shape.switchShape(S.ShapeBuilder.letter("")),document.getElementById("stage").style.transform="scale(1,1)"):s(a):S.Shape.switchShape(S.ShapeBuilder.letter(t),!0)}),1e3,t=(t=parseInt(t)||10)>0?t:10,!0);break;case"rectangle":t=t&&t.split("x"),S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(n,parseInt((t=t&&2===t.length?t:[n,15])[0])),Math.min(n,parseInt(t[1]))));break;case"circle":S.Shape.switchShape(S.ShapeBuilder.circle(t=Math.min(t=parseInt(t)||n,n)));break;case"time":var l=r(new Date);a.length>0?S.Shape.switchShape(S.ShapeBuilder.letter(l)):o((function(){(l=r(new Date))!==i&&S.Shape.switchShape(S.ShapeBuilder.letter(i=l))}),1e3);break;default:S.Shape.switchShape(S.ShapeBuilder.letter(c[0]===h?"HacPai":c))}}),2e3,(a="object"==typeof t?t:a.concat(t.split("|"))).length)}return{simulate:function(t){s(t)}}}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,e){this.p=new S.Point({x:t,y:e,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],n=e[1],a=e[2],h=this.e*a;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(a>1)this.p.x-=i/a*h,this.p.y-=n/a*h;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(t,e){var i=this.p.x-t.x,n=this.p.y-t.y,a=Math.sqrt(i*i+n*n);return e?[i,n,a]:a},move:function(t,e){(!e||e&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){var t=13,e=document.createElement("canvas"),i=e.getContext("2d"),n=500;function a(){e.width=Math.floor(window.innerWidth/t)*t,e.height=Math.floor(window.innerHeight/t)*t,i.fillStyle="red",i.textBaseline="middle",i.textAlign="center"}function r(){var n=i.getImageData(0,0,e.width,e.height).data;dots=[],x=0,y=0,fx=e.width,fy=e.height,w=0,h=0;for(var a=0;a<n.length;a+=4*t)n[a+3]>0&&(dots.push(new S.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=t,x>=e.width&&(x=0,y+=t,a+=4*t*e.width);return{dots:dots,w:w+fx,h:h+fy}}function o(t){i.font="bold "+t+"px Avenir, Helvetica Neue, Helvetica, Arial, sans-serif"}return a(),window.addEventListener("resize",a),{imageFile:function(t,n){var a=new Image,h=S.Drawing.getArea();a.onload=function(){i.clearRect(0,0,e.width,e.height),i.drawImage(this,0,0,.6*h.h,.6*h.h),n(r())},a.onerror=function(){n(S.ShapeBuilder.letter("What?"))},a.src=t},circle:function(n){var a=Math.max(0,n)/2;return i.clearRect(0,0,e.width,e.height),i.beginPath(),i.arc(a*t,a*t,a*t,0,2*Math.PI,!1),i.fill(),i.closePath(),r()},letter:function(t){var a;return o(n),o(Math.min(n,e.width/i.measureText(t).width*.8*n,e.height/n*(!isNaN(parseFloat(a=t))&&isFinite(a)?1:.45)*n)),i.clearRect(0,0,e.width,e.height),i.fillText(t,e.width/2,e.height/2),r()},rectangle:function(e,i){for(var n=[],a=t*e,h=t*i,r=0;r<h;r+=t)for(var o=0;o<a;o+=t)n.push(new S.Point({x:o,y:r}));return{dots:n,w:a,h:h}}}}(),S.Shape=function(){var t=[],e=0,i=0,n=0,a=0;return{shuffleIdle:function(){for(var e=S.Drawing.getArea(),i=0;i<t.length;i++)t[i].s||t[i].move({x:Math.random()*e.w,y:Math.random()*e.h})},switchShape:function(h,r){var o,s=S.Drawing.getArea();if(e=h.w,i=h.h,function(){var t=S.Drawing.getArea();n=t.w/2-e/2,a=t.h/2-i/2}(),h.dots.length>t.length){o=h.dots.length-t.length;for(var c=1;c<=o;c++)t.push(new S.Dot(s.w/2,s.h/2))}c=0;for(var d=0;h.dots.length>0;)d=Math.floor(Math.random()*h.dots.length),t[c].e=r?.25:t[c].s?.14:.11,t[c].move(new S.Point(t[c].s?{z:20*Math.random()+10,a:Math.random(),h:18}:{z:5*Math.random()+5,h:r?18:30})),t[c].s=!0,t[c].move(new S.Point({x:h.dots[d].x+n,y:h.dots[d].y+a,a:1,z:5,h:0})),h.dots=h.dots.slice(0,d).concat(h.dots.slice(d+1)),c++;for(d=c;d<t.length;d++)t[d].s&&(t[d].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),t[d].s=!1,t[d].e=.04,t[d].move(new S.Point({x:Math.random()*s.w,y:Math.random()*s.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var e=0;e<t.length;e++)t[e].render()}}}(),S.init();var canvas=document.getElementById("My_canvas");canvas.style.display="block",setTimeout((function(){canvas.style.display="none"}),12e3);